<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Solar System</title>
    <link rel="stylesheet" href="style.css">
    <style>
        /* style.css */
        body {
            margin: 0;
            overflow: hidden;
            font-family: 'Arial', sans-serif;
            background-color: #000010; /* Deep space blue */
            color: #fff;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
        }

        #solar-system-canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
        }

        #info-panel {
            position: absolute;
            top: 20px;
            right: -400px; /* Start off-screen */
            width: 350px;
            background-color: rgba(0, 20, 50, 0.85);
            border-left: 2px solid #00aaff;
            border-bottom: 2px solid #00aaff;
            padding: 20px;
            box-shadow: -5px 5px 15px rgba(0, 100, 200, 0.3);
            border-radius: 8px 0 0 8px;
            z-index: 10;
            opacity: 0;
            transition: right 0.5s ease-out, opacity 0.5s ease-out; /* For anime.js to target */
        }

        #info-panel.visible {
            right: 0px;
            opacity: 1;
        }

        #info-panel h2 {
            margin-top: 0;
            color: #00aaff;
            border-bottom: 1px solid #0077cc;
            padding-bottom: 10px;
        }

        #info-panel p {
            font-size: 0.9em;
            line-height: 1.6;
            margin-bottom: 10px;
        }

        #info-panel strong {
            color: #80dfff;
        }

        #close-info {
            position: absolute;
            top: 10px;
            right: 10px;
            background: none;
            border: none;
            color: #aaa;
            font-size: 20px;
            cursor: pointer;
        }
        #close-info:hover {
            color: #fff;
        }

        #title-overlay {
            position: absolute;
            top: 20px;
            left: 20px;
            z-index: 5;
            font-size: 2.5em;
            color: rgba(255, 255, 255, 0.8);
            text-shadow: 0 0 10px #00aaff, 0 0 20px #00aaff;
        }

        #loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: #000010;
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            color: #fff;
            font-size: 1.5em;
        }
    </style>
</head>
<body>
    <div id="loading-screen">Loading Solar System...</div>
    <div id="title-overlay">Our Solar System</div>
    <canvas id="solar-system-canvas"></canvas>
    <div id="info-panel">
        <button id="close-info">&times;</button>
        <h2 id="planet-name">Planet Name</h2>
        <p><strong>Radius:</strong> <span id="planet-radius"></span> km</p>
        <p><strong>Distance from Sun:</strong> <span id="planet-distance"></span> million km</p>
        <p><strong>Orbital Period:</strong> <span id="planet-orbit-period"></span> Earth days/years</p>
        <p><strong>Day Length:</strong> <span id="planet-day-length"></span> Earth hours/days</p>
        <p id="planet-description">Description of the planet goes here.</p>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js"></script>
    <script src="https://unpkg.com/three@0.128.0/examples/js/controls/OrbitControls.js"></script>

    <script>
        // script.js
        document.addEventListener('DOMContentLoaded', () => {
            const canvas = document.getElementById('solar-system-canvas');
            const infoPanel = document.getElementById('info-panel');
            const closeInfoButton = document.getElementById('close-info');
            const loadingScreen = document.getElementById('loading-screen');

            let scene, camera, renderer, controls;
            let sun, planets = [], orbits = [];
            let raycaster, mouse;
            let INTERSECTED;
            let isFocused = false;
            let originalCameraPosition = new THREE.Vector3(0, 150, 400); // Initial overview

            const planetData = [
                { name: "Mercury", radius: 0.38, distance: 38, color: 0x888888, speed: 0.04, rotationSpeed: 0.01, orbitPeriod: "88 days", dayLength: "58.6 days", description: "The smallest planet in our solar system and nearest to the Sun, Mercury is only slightly larger than Earth's Moon." },
                { name: "Venus", radius: 0.95, distance: 72, color: 0xFFFFCC, speed: 0.035, rotationSpeed: 0.002, orbitPeriod: "224.7 days", dayLength: "243 days (retrograde)", description: "Venus spins slowly in the opposite direction from most planets. A thick atmosphere traps heat in a runaway greenhouse effect, making it the hottest planet in our solar system." },
                { name: "Earth", radius: 1, distance: 100, color: 0x0077FF, speed: 0.03, rotationSpeed: 0.01, orbitPeriod: "365.25 days", dayLength: "23.9 hours", description: "Our home planet is the only place we know of so far that’s inhabited by living things. It’s also the only planet in our solar system with liquid water on the surface." },
                { name: "Mars", radius: 0.53, distance: 152, color: 0xFF5733, speed: 0.024, rotationSpeed: 0.009, orbitPeriod: "1.88 years", dayLength: "24.6 hours", description: "Mars is a dusty, cold, desert world with a very thin atmosphere. There is strong evidence Mars was – billions of years ago – wetter and warmer, with a thicker atmosphere." },
                { name: "Jupiter", radius: 11.2, distance: 250, color: 0xFFCC99, speed: 0.013, rotationSpeed: 0.025, orbitPeriod: "11.86 years", dayLength: "9.9 hours", description: "Jupiter is more than twice as massive than the other planets of our solar system combined. The giant planet's Great Red spot is a centuries-old storm bigger than Earth." },
                { name: "Saturn", radius: 9.45, distance: 350, color: 0xCCCC99, speed: 0.009, rotationSpeed: 0.023, hasRings: true, orbitPeriod: "29.46 years", dayLength: "10.7 hours", description: "Adorned with thousands of beautiful ringlets, Saturn is unique among the planets. It is not the only planet to have rings, but none are as spectacular or as complex as Saturn's." },
                { name: "Uranus", radius: 4, distance: 450, color: 0xAFEEEE, speed: 0.006, rotationSpeed: 0.015, orbitPeriod: "84 years", dayLength: "17.2 hours (retrograde)", description: "Uranus rotates at a nearly 90-degree angle from the plane of its orbit. This unique tilt makes Uranus appear to spin on its side." },
                { name: "Neptune", radius: 3.88, distance: 550, color: 0x3366FF, speed: 0.005, rotationSpeed: 0.016, orbitPeriod: "164.8 years", dayLength: "16.1 hours", description: "Neptune—the eighth and most distant major planet orbiting our Sun—is dark, cold and whipped by supersonic winds. It was the first planet located through mathematical calculations." }
            ];
            // Scaling factors for visual representation
            const SUN_RADIUS_SCALE = 15;
            const PLANET_RADIUS_SCALE = 2;
            const ORBIT_SCALE = 1.2; // To make orbits more visible, not strictly to scale

            function init() {
                // Scene
                scene = new THREE.Scene();

                // Camera
                camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 2000);
                camera.position.copy(originalCameraPosition);
                camera.lookAt(scene.position);

                // Renderer
                renderer = new THREE.WebGLRenderer({ canvas: canvas, antialias: true, alpha: true });
                renderer.setSize(window.innerWidth, window.innerHeight);
                renderer.setPixelRatio(window.devicePixelRatio);
                // renderer.setClearColor(0x000000, 0); // Transparent background for body bg

                // Lighting
                const ambientLight = new THREE.AmbientLight(0x404040, 1.5); // Softer ambient
                scene.add(ambientLight);

                const pointLight = new THREE.PointLight(0xFFFFFF, 2, 2000); // Sun's light
                scene.add(pointLight);

                // Controls
                controls = new THREE.OrbitControls(camera, renderer.domElement);
                controls.enableDamping = true;
                controls.dampingFactor = 0.05;
                controls.screenSpacePanning = false;
                controls.minDistance = 20;
                controls.maxDistance = 1000;

                // Sun
                const sunGeometry = new THREE.SphereGeometry(SUN_RADIUS_SCALE, 64, 64);
                const sunMaterial = new THREE.MeshStandardMaterial({
                    emissive: 0xFFFF00, // Sun emits light
                    emissiveIntensity: 1,
                    map: createSunTexture() // Procedural texture
                });
                sun = new THREE.Mesh(sunGeometry, sunMaterial);
                sun.name = "Sun"; // For raycasting if needed
                sun.userData = { type: 'star', description: "The star at the center of our Solar System." };
                scene.add(sun);
                pointLight.position.set(0, 0, 0); // Light emanates from sun center

                // Planets and Orbits
                planetData.forEach(data => {
                    const planetGeometry = new THREE.SphereGeometry(data.radius * PLANET_RADIUS_SCALE, 32, 32);
                    // Simple color material, replace with TextureLoader for images
                    const planetMaterial = new THREE.MeshStandardMaterial({ color: data.color, roughness: 0.8, metalness: 0.1 });
                    const planet = new THREE.Mesh(planetGeometry, planetMaterial);
                    planet.name = data.name;
                    planet.userData = data; // Store all data
                    planet.userData.type = 'planet';
                    planet.userData.baseRadius = data.radius * PLANET_RADIUS_SCALE; // For focus distance

                    // Orbit pivot
                    const orbitPivot = new THREE.Object3D();
                    scene.add(orbitPivot);
                    planet.position.x = data.distance * ORBIT_SCALE;
                    orbitPivot.add(planet);
                    planets.push({ mesh: planet, pivot: orbitPivot, speed: data.speed, rotationSpeed: data.rotationSpeed });

                    // Orbit line
                    const orbitGeometry = new THREE.BufferGeometry().setFromPoints(
                        new THREE.Path().absarc(0, 0, data.distance * ORBIT_SCALE, 0, Math.PI * 2, false).getSpacedPoints(128)
                    );
                    const orbitMaterial = new THREE.LineBasicMaterial({ color: 0xAAAAAA, transparent: true, opacity: 0.3 });
                    const orbitLine = new THREE.Line(orbitGeometry, orbitMaterial);
                    orbitLine.rotation.x = Math.PI / 2; // Rotate to be flat on XZ plane
                    scene.add(orbitLine);
                    orbits.push(orbitLine);

                    // Rings for Saturn
                    if (data.hasRings) {
                        const ringGeometry = new THREE.RingGeometry(data.radius * PLANET_RADIUS_SCALE * 1.2, data.radius * PLANET_RADIUS_SCALE * 2, 64);
                        const ringMaterial = new THREE.MeshBasicMaterial({ color: 0x999966, side: THREE.DoubleSide, transparent: true, opacity: 0.6 });
                        const ringMesh = new THREE.Mesh(ringGeometry, ringMaterial);
                        ringMesh.rotation.x = Math.PI / 2 * 1.1; // Tilt rings slightly
                        planet.add(ringMesh);
                    }
                });
                
                // Starry background
                createStarfield();

                // Raycaster
                raycaster = new THREE.Raycaster();
                mouse = new THREE.Vector2();

                // Event Listeners
                window.addEventListener('resize', onWindowResize, false);
                canvas.addEventListener('click', onCanvasClick, false);
                closeInfoButton.addEventListener('click', closeInfoPanel);

                // Hide loading screen
                anime({
                    targets: loadingScreen,
                    opacity: 0,
                    duration: 500,
                    easing: 'easeInOutQuad',
                    complete: () => loadingScreen.style.display = 'none'
                });

                animate();
            }
            
            function createSunTexture() {
                const canvas = document.createElement('canvas');
                canvas.width = 256;
                canvas.height = 256;
                const context = canvas.getContext('2d');
                
                // Create a radial gradient for a fiery sun effect
                const gradient = context.createRadialGradient(128, 128, 20, 128, 128, 128);
                gradient.addColorStop(0, 'rgba(255, 255, 200, 1)'); // Core
                gradient.addColorStop(0.2, 'rgba(255, 200, 0, 1)');   // Yellow
                gradient.addColorStop(0.4, 'rgba(255, 150, 0, 0.9)'); // Orange
                gradient.addColorStop(0.8, 'rgba(200, 100, 0, 0.5)'); // Reddish
                gradient.addColorStop(1, 'rgba(100, 50, 0, 0.1)');    // Fading edge

                context.fillStyle = gradient;
                context.fillRect(0, 0, 256, 256);

                // Add some noise/turbulence (simple version)
                for (let i = 0; i < 2000; i++) {
                    const x = Math.random() * 256;
                    const y = Math.random() * 256;
                    const size = Math.random() * 2 + 1;
                    const alpha = Math.random() * 0.3 + 0.1;
                    context.fillStyle = `rgba(255, 230, 180, ${alpha})`;
                    context.fillRect(x, y, size, size);
                }
                
                return new THREE.CanvasTexture(canvas);
            }


            function createStarfield() {
                const starGeometry = new THREE.BufferGeometry();
                const starMaterial = new THREE.PointsMaterial({
                    color: 0xffffff,
                    size: 1,
                    sizeAttenuation: true,
                    transparent: true,
                    opacity: 0.8
                });

                const starVertices = [];
                for (let i = 0; i < 10000; i++) {
                    const x = THREE.MathUtils.randFloatSpread(1500); // Spread them out
                    const y = THREE.MathUtils.randFloatSpread(1500);
                    const z = THREE.MathUtils.randFloatSpread(1500);
                    // Ensure stars are far enough to not clip with planets or sun
                    if (Math.sqrt(x*x + y*y + z*z) < 600) { // Minimum distance for stars
                        const R = 600 + Math.random() * 900; // Random radius between 600 and 1500
                        const phi = Math.random() * Math.PI * 2;
                        const theta = Math.acos(2 * Math.random() - 1);
                        starVertices.push(R * Math.sin(theta) * Math.cos(phi), R * Math.sin(theta) * Math.sin(phi), R * Math.cos(theta));
                    } else {
                        starVertices.push(x, y, z);
                    }
                }

                starGeometry.setAttribute('position', new THREE.Float32BufferAttribute(starVertices, 3));
                const starField = new THREE.Points(starGeometry, starMaterial);
                scene.add(starField);
            }


            function onWindowResize() {
                camera.aspect = window.innerWidth / window.innerHeight;
                camera.updateProjectionMatrix();
                renderer.setSize(window.innerWidth, window.innerHeight);
            }

            function onCanvasClick(event) {
                event.preventDefault();

                mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
                mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;

                raycaster.setFromCamera(mouse, camera);
                const intersects = raycaster.intersectObjects(planets.map(p => p.mesh).concat(sun)); // Check sun too

                if (intersects.length > 0) {
                    if (INTERSECTED != intersects[0].object) {
                        INTERSECTED = intersects[0].object;
                        focusOnObject(INTERSECTED);
                        showInfoPanel(INTERSECTED.userData);
                    }
                } else {
                     // Clicked on empty space, reset view if focused
                    if (isFocused) {
                        resetCameraView();
                        closeInfoPanel();
                        INTERSECTED = null;
                    }
                }
            }
            
            function focusOnObject(targetObject) {
                isFocused = true;
                controls.enabled = false; // Disable orbit controls during programmatic animation

                const targetPosition = new THREE.Vector3();
                targetObject.getWorldPosition(targetPosition);

                const offsetDistance = targetObject.userData.type === 'star' ? 
                                       SUN_RADIUS_SCALE * 5 : 
                                       (targetObject.userData.baseRadius || 5) * 5; // Look from 5x radius away
                
                // Calculate camera position: slightly above and in front of the planet relative to its current view
                // This is a bit tricky. For simplicity, let's aim for a position relative to the planet.
                const cameraTargetPosition = new THREE.Vector3()
                    .copy(targetPosition)
                    .add(new THREE.Vector3(0, (targetObject.userData.baseRadius || 5) * 1, offsetDistance)); // Adjust Z for distance

                anime.remove(camera.position); // Remove previous animations on camera position
                anime.remove(controls.target); // Remove previous animations on controls target

                anime({
                    targets: camera.position,
                    x: cameraTargetPosition.x,
                    y: cameraTargetPosition.y,
                    z: cameraTargetPosition.z,
                    duration: 1500,
                    easing: 'easeInOutQuad',
                    update: () => {
                        // camera.lookAt(targetPosition) // Keep looking at the target
                    }
                });

                anime({
                    targets: controls.target, // Animate OrbitControls target
                    x: targetPosition.x,
                    y: targetPosition.y,
                    z: targetPosition.z,
                    duration: 1500,
                    easing: 'easeInOutQuad',
                    complete: () => {
                        controls.enabled = true; // Re-enable orbit controls
                        controls.update(); // Important to sync controls
                    }
                });
            }

            function resetCameraView() {
                isFocused = false;
                controls.enabled = false;

                anime.remove(camera.position);
                anime.remove(controls.target);

                anime({
                    targets: camera.position,
                    x: originalCameraPosition.x,
                    y: originalCameraPosition.y,
                    z: originalCameraPosition.z,
                    duration: 1500,
                    easing: 'easeInOutQuad',
                     update: () => {
                        // camera.lookAt(scene.position)
                    }
                });
                anime({
                    targets: controls.target,
                    x: scene.position.x,
                    y: scene.position.y,
                    z: scene.position.z,
                    duration: 1500,
                    easing: 'easeInOutQuad',
                    complete: () => {
                        controls.enabled = true;
                        controls.update();
                    }
                });
            }

            function showInfoPanel(data) {
                document.getElementById('planet-name').textContent = data.name || "Celestial Body";
                if (data.type === 'planet') {
                    document.getElementById('planet-radius').textContent = `${(data.radius * 6371).toFixed(0)} km (scaled: ${(data.radius * PLANET_RADIUS_SCALE).toFixed(1)})`; // Earth actual radius = 6371km
                    document.getElementById('planet-distance').textContent = `${(data.distance * 1.496).toFixed(1)} million km (scaled: ${(data.distance * ORBIT_SCALE).toFixed(1)})`; // 100 units = 1 AU = 149.6 million km
                    document.getElementById('planet-orbit-period').textContent = data.orbitPeriod;
                    document.getElementById('planet-day-length').textContent = data.dayLength;
                    document.getElementById('planet-description').textContent = data.description;
                    // Show specific fields
                    document.getElementById('planet-radius').closest('p').style.display = '';
                    document.getElementById('planet-distance').closest('p').style.display = '';
                    document.getElementById('planet-orbit-period').closest('p').style.display = '';
                    document.getElementById('planet-day-length').closest('p').style.display = '';

                } else if (data.type === 'star') {
                    document.getElementById('planet-radius').textContent = `${(SUN_RADIUS_SCALE / PLANET_RADIUS_SCALE * 6371).toFixed(0)} km (scaled: ${SUN_RADIUS_SCALE.toFixed(1)})`; // Approx.
                    document.getElementById('planet-distance').closest('p').style.display = 'none';
                    document.getElementById('planet-orbit-period').closest('p').style.display = 'none';
                    document.getElementById('planet-day-length').closest('p').style.display = 'none';
                    document.getElementById('planet-description').textContent = data.description;
                }


                if (!infoPanel.classList.contains('visible')) {
                    infoPanel.classList.add('visible'); // Use CSS transition for initial slide-in
                    anime({ // Then use anime.js for potential further animations or if CSS transitions aren't enough
                        targets: infoPanel,
                        right: '0px',
                        opacity: 1,
                        duration: 500,
                        easing: 'easeOutExpo'
                    });
                }
            }

            function closeInfoPanel() {
                INTERSECTED = null; // Clear intersected object if panel is closed manually
                if (isFocused) { // If focused on something, reset camera too
                    resetCameraView();
                }
                anime({
                    targets: infoPanel,
                    right: '-400px',
                    opacity: 0,
                    duration: 500,
                    easing: 'easeInExpo',
                    complete: () => {
                        infoPanel.classList.remove('visible');
                    }
                });
            }

            let clock = new THREE.Clock();
            function animate() {
                requestAnimationFrame(animate);
                const delta = clock.getDelta();

                // Animate planets: orbital rotation and axial rotation
                planets.forEach(p => {
                    p.pivot.rotation.y += p.speed * delta * 5; // Orbital speed (scaled for visibility)
                    p.mesh.rotation.y += p.rotationSpeed * delta * 20; // Axial rotation (scaled)
                });
                
                // Sun self-rotation (slowly)
                if (sun) sun.rotation.y += 0.0005;


                controls.update(); // Required if enableDamping is true
                renderer.render(scene, camera);
            }

            init();
        });
    </script>
</body>
</html>